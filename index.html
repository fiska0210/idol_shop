<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¶åƒå‘¨é‚Šå•†åº— PWA</title>
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <!-- iOS Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ec4899">
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/ec4899/ffffff?text=Shop">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <style>
        /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒåŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans antialiased">

<div id="app" class="pb-20">
    <!-- Header -->
    <header class="bg-pink-600 text-white p-4 sticky top-0 z-50 shadow-md flex justify-between items-center">
        <div>
            <h1 class="text-xl font-bold">ğŸŒŸ å¶åƒå‘¨é‚Šå•†åº—</h1>
        </div>
        <button @click="showCart = true" class="relative p-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
            </svg>
            <span v-if="cart.length > 0" class="absolute top-0 right-0 bg-yellow-400 text-pink-800 text-xs font-bold px-1.5 py-0.5 rounded-full animate-bounce">
                {{ cartTotalItems }}
            </span>
        </button>
    </header>

    <!-- PWA Install Button (Only shows if installable) -->
    <div v-if="deferredPrompt" class="p-4 bg-blue-100 flex justify-between items-center">
        <span class="text-sm text-blue-800">å–œæ­¡é€™å€‹å•†åº—å—ï¼Ÿå®‰è£åˆ°æ‰‹æ©Ÿæ¡Œé¢ï¼</span>
        <button @click="installPWA" class="bg-blue-600 text-white px-3 py-1 rounded text-sm shadow">å®‰è£ App</button>
    </div>

    <!-- Category Tabs -->
    <nav class="flex justify-center my-4 space-x-4 px-4">
        <button 
            @click="currentCategory = 'concert'"
            :class="currentCategory === 'concert' ? 'bg-pink-600 text-white shadow-lg scale-105' : 'bg-white text-gray-600 border'"
            class="px-6 py-2 rounded-full transition-all duration-300 font-medium text-sm sm:text-base w-1/2">
            ğŸ¤ æ¼”å”±æœƒå‘¨é‚Š
        </button>
        <button 
            @click="currentCategory = 'fanmeet'"
            :class="currentCategory === 'fanmeet' ? 'bg-purple-600 text-white shadow-lg scale-105' : 'bg-white text-gray-600 border'"
            class="px-6 py-2 rounded-full transition-all duration-300 font-medium text-sm sm:text-base w-1/2">
            ğŸ¤ è¦‹é¢æœƒå‘¨é‚Š
        </button>
    </nav>

    <!-- Product Grid -->
    <main class="container mx-auto px-4">
        <h2 class="text-lg font-bold mb-4 text-gray-700 border-l-4 pl-3" :class="currentCategory === 'concert' ? 'border-pink-500' : 'border-purple-500'">
            {{ currentCategory === 'concert' ? 'WORLD TOUR 2025 é™å®šå•†å“' : 'FAN MEETING "WITH YOU" ç¨å®¶' }}
        </h2>
        
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <div v-for="product in filteredProducts" :key="product.id" class="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-lg transition-shadow border border-gray-100 flex flex-col">
                <div class="relative aspect-square">
                    <img :src="product.image" :alt="product.name" class="object-cover w-full h-full">
                    <span v-if="product.isHot" class="absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded font-bold">ç†±éŠ·</span>
                </div>
                <div class="p-3 flex flex-col flex-grow">
                    <h3 class="font-medium text-gray-800 line-clamp-2 mb-1">{{ product.name }}</h3>
                    <div class="mt-auto flex justify-between items-center">
                        <span class="text-lg font-bold text-gray-900">${{ product.price }}</span>
                        <button @click="addToCart(product)" class="bg-gray-900 text-white p-2 rounded-full active:scale-95 transition-transform">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Shopping Cart Sidebar (Modal) -->
    <div v-if="showCart" class="fixed inset-0 z-[60] flex justify-end">
        <!-- Backdrop -->
        <div @click="showCart = false" class="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity"></div>
        
        <!-- Cart Content -->
        <div class="relative w-full max-w-md bg-white h-full shadow-2xl flex flex-col transform transition-transform duration-300">
            <div class="p-4 border-b flex justify-between items-center bg-gray-50">
                <h2 class="text-lg font-bold">ğŸ›’ è³¼ç‰©è»Š</h2>
                <button @click="showCart = false" class="text-gray-500 hover:text-gray-800">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-4 space-y-4">
                <div v-if="cart.length === 0" class="text-center text-gray-400 py-10">
                    <p>è³¼ç‰©è»Šæ˜¯ç©ºçš„ ğŸ¥²</p>
                    <button @click="showCart = false" class="mt-4 text-pink-600 font-bold">å»é€›é€›</button>
                </div>
                <div v-else v-for="(item, index) in cart" :key="index" class="flex items-center gap-4 bg-gray-50 p-3 rounded-lg">
                    <img :src="item.image" class="w-16 h-16 rounded object-cover bg-gray-200">
                    <div class="flex-1">
                        <h4 class="font-medium text-sm text-gray-800">{{ item.name }}</h4>
                        <p class="text-pink-600 font-bold">${{ item.price }}</p>
                    </div>
                    <button @click="removeFromCart(index)" class="text-red-400 hover:text-red-600">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="p-4 border-t bg-gray-50">
                <div class="flex justify-between mb-4 text-lg font-bold">
                    <span>ç¸½é‡‘é¡</span>
                    <span>${{ cartTotalAmount }}</span>
                </div>
                <button @click="checkout" class="w-full bg-pink-600 text-white py-3 rounded-lg font-bold shadow-lg active:scale-95 transition-transform">
                    å‰å¾€çµå¸³
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                currentCategory: 'concert', // concert or fanmeet
                showCart: false,
                cart: [],
                products: [], // Will be generated
                deferredPrompt: null
            }
        },
        computed: {
            filteredProducts() {
                return this.products.filter(p => p.category === this.currentCategory);
            },
            cartTotalItems() {
                return this.cart.length;
            },
            cartTotalAmount() {
                return this.cart.reduce((sum, item) => sum + item.price, 0);
            }
        },
        methods: {
            addToCart(product) {
                this.cart.push(product);
                // Simple feedback (vibrate on mobile)
                if (navigator.vibrate) navigator.vibrate(50);
            },
            removeFromCart(index) {
                this.cart.splice(index, 1);
            },
            checkout() {
                if (this.cart.length === 0) return;

                // 1. æ•´ç†è³¼ç‰©è»Šå…§å®¹ç‚ºæ–‡å­—
                let orderText = "ã€æ–°è¨‚å–®ã€‘\n";
                this.cart.forEach((item, index) => {
                    orderText += `${index + 1}. ${item.name} - $${item.price}\n`;
                });
                orderText += `\nç¸½é‡‘é¡ï¼š$${this.cartTotalAmount}`;

                // 2. Google è¡¨å–®è¨­å®š (è«‹æ›¿æ›æˆä½ çš„é€£çµèˆ‡ ID)
                // ä½ çš„è¡¨å–®ç¶²å€ (å»æ‰å¾Œé¢çš„ ?usp=...)
                const formBaseUrl = "https://docs.google.com/forms/d/e/1FAIpQLSdVpUF4MSL7xI0GeycpfNl-x2Gs4SjP2XIA--WLgrF2ppyYpg/viewform"; 
                // ä½ çš„ã€Œè¨‚å–®å…§å®¹ã€æ¬„ä½ ID
                const entryId = "entry.745452943"; 

                // 3. çµ„åˆç¶²å€ä¸¦è·³è½‰
                const finalUrl = `${formBaseUrl}?usp=pp_url&${entryId}=${encodeURIComponent(orderText)}`;
                
                // é–‹å•Ÿæ–°åˆ†é è®“ä½¿ç”¨è€…å¡«å¯«å¯„é€è³‡è¨Šï¼Œä½†è¨‚å–®å…§å®¹å·²è‡ªå‹•å¡«å¥½
                window.open(finalUrl, '_blank');
                
                // é¸æ“‡æ€§ï¼šæ¸…ç©ºè³¼ç‰©è»Š
                // this.cart = [];
                // this.showCart = false;
            },
            generateProducts() {
                const concertItems = [
                    'å®˜æ–¹æ‰‹ç‡ˆ Ver.2', 'ä¸–ç•Œå·¡è¿´ç´€å¿µ T-shirt', 'æ‡‰æ´æ¯›å·¾', 'ç…§ç‰‡å°å¡çµ„ (Aç‰ˆ)', 
                    'å¸†å¸ƒæ‰˜ç‰¹åŒ…', 'å£“å…‹åŠ›ç«‹ç‰Œ', 'é™é‡æµ·å ±çµ„', 'å°ˆå±¬æ‡‰æ´æ‰‡', 
                    'æ¼”å”±æœƒå ´åˆŠ', 'é€£å¸½è¡›è¡£', 'ç´€å¿µå¾½ç« çµ„', 'æ‰‹æ©Ÿæ”¯æ¶', 
                    'æ£’çƒå¸½', 'ä¾¿æ”œæ°´å£º', 'è²¼ç´™çµ„', 'é‘°åŒ™åœˆ', 
                    'è­·ç…§å¤¾', 'è¡ŒæåŠç‰Œ', 'è¡Œå‹•é›»æº', 'éš¨èº«é¡'
                ];
                
                const fanmeetItems = [
                    'è¦‹é¢æœƒé™å®šæ‹ç«‹å¾—', 'å¿ƒå‹•æŠ±æ•', 'èªéŸ³é¬§é˜', 'æ¡Œæ›† 2025', 
                    'æ˜ä¿¡ç‰‡æ›¸', 'Qç‰ˆç©å¶', 'IDå¡å¥—çµ„', 'å¸†å¸ƒæ”¶ç´è¢‹', 
                    'é¦™æ°›è Ÿç‡­', 'é¦¬å…‹æ¯', 'æ»‘é¼ å¢Š', 'ç­†è¨˜æœ¬çµ„', 
                    'ç´™è† å¸¶', 'é€æ‰‡', 'æ‰‹æ©Ÿæ®¼', 'é«®å¸¶', 
                    'è¥ªå­çµ„', 'å£ç½©æ”¶ç´å¤¾', 'ç’°ä¿å¸ç®¡çµ„', 'é‡é¤å¢Š'
                ];

                let idCounter = 1;

                // Create Concert Products
                concertItems.forEach(name => {
                    this.products.push({
                        id: idCounter++,
                        name: name,
                        price: Math.floor(Math.random() * (2000 - 300) + 300), // Random price 300-2000
                        category: 'concert',
                        isHot: Math.random() > 0.8,
                        image: `https://placehold.co/400x400/ec4899/ffffff?text=${encodeURIComponent(name.substring(0,4))}`
                    });
                });

                // Create Fanmeet Products
                fanmeetItems.forEach(name => {
                    this.products.push({
                        id: idCounter++,
                        name: name,
                        price: Math.floor(Math.random() * (1500 - 200) + 200), // Random price 200-1500
                        category: 'fanmeet',
                        isHot: Math.random() > 0.8,
                        image: `https://placehold.co/400x400/9333ea/ffffff?text=${encodeURIComponent(name.substring(0,4))}`
                    });
                });
            },
            async installPWA() {
                if (this.deferredPrompt) {
                    this.deferredPrompt.prompt();
                    const { outcome } = await this.deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        this.deferredPrompt = null;
                    }
                }
            }
        },
        mounted() {
            this.generateProducts();
            
            // PWA Install Prompt Capture
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                this.deferredPrompt = e;
            });

            // Service Worker Registration
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered', reg))
                    .catch(err => console.log('SW Error', err));
            }
        }
    }).mount('#app');
</script>
</body>
</html>